<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
	<style>
		.container {
			width: 300px; 
			height: 530px; 
			border-radius: 10px; 
			text-align: center; 
			position: relative; 
			left: 750px; 
			top: 50%; 
			overflow: auto;
			margin-top: 100px;
			padding-bottom: 0;
		}
		.container::-webkit-scrollbar {
		  width: 0px;
		}
		.h1-size {
			font-size: 2em !important;
			margin: 0px;
		}
	</style>
</head>
<body>
	<section>
		<article>
			<fieldset class="container">
				<legend style="text-align: left;"><h1 class="h1-size"><b style="text-transform:uppercase;">
					<div OnClick="location.href ='javascript:history.back()'" style="cursor: pointer;">
					<img src="https://cdn-icons-png.flaticon.com/512/130/130882.png" style="width: 22px">
					{{userEntity.user_id}}</b></h1>
				</div>
				</legend>
				<script>
					var i=0;
				</script>
				<div style="position: relative; float: left; margin: 0; height: 70px;">
					<div style="position: relative; float: left; width: 68px; height: 68px; border-radius: 35px; border: 1px solid black;">
							<input type="hidden" value="{{userEntity.profile_photo}}" id="getprofile_photo">
							<script>
								var a = document.querySelectorAll("#getprofile_photo");
								var x = [];
								x.push(a[i].value);
								if(a[i].value == 0) {
									console.log("사진없음");
									document.write("<img src=\"https://www.snsboom.co.kr/common/img/default_profile.png\" style=\"border-radius: 35px; width: 100%; height: 100%;\">");
								}
								else {
									document.write("<img src=\"{{userEntity.profile_photo}}\" style=\"border-radius: 35px; width: 100%; height: 100%;\">");
								}
								i++;
							</script>
					</div>
					<div style="position: relative; float: left; height: 70px; text-align: center;">
						<div style="position: relative; float: left; width: 100px; height: 50px; margin-left: 29px; text-align: center;">
							<p OnClick="location.href ='/profile/follower/{{userEntity.user_id}}'" style="cursor: pointer; position: relative; width: auto; margin: 0px; margin-top: 0;"><b style="position: relative;">{{followcount}}<br>팔로워</b></p>
						</div>
						<div style="position: relative; float: left; width: 80px; height: 50px; text-align: center;">
							<p OnClick="location.href ='/profile/following/{{userEntity.user_id}}'" style="cursor: pointer; position: relative; width: auto; margin: 0px; margin-top: 0;"><b style="position: relative;">{{followingcount}}<br>팔로잉</b></p>
						</div>
						<input type="hidden" value="{{userEntity.user_id}}" id="logout-user-id">
						<input type="hidden" value="{{loginEntity.user_id}}" id="login-user-id">
						<input type="hidden" value="{{followbool}}" id="followbool">
						<script>
							var a = document.querySelector("#logout-user-id");
							var b = document.querySelector("#login-user-id");
							var follow = document.querySelector("#followbool");
							console.log(follow.value);
							if(a.value == b.value) {
								document.write("<div style=\"position: relative; margin-left: 24px; width: 200px; height: 15px;\"><button OnClick=\"location.href ='/profile/edit/{{userEntity.user_id}}'\" id=\"search-id\" style=\"cursor: pointer; border-radius: 10px; width: 100%; border: none; background-color: rgb(220, 220, 220);\" type=\"button\"><b>프로필 편집</b></button></div>");
							} else {
								if(follow.value == 1) {
									document.write("<div style=\"position: relative; margin-left: 24px; width: 200px; height: 15px;\"><button id=\"delete-follow\" style=\"cursor: pointer; border-radius: 10px; width: 100%; border: none; background-color: rgb(220, 220, 220);\" type=\"button\"><b>팔로우 취소</b></button></div>");
								} else {
									document.write("<div style=\"position: relative; margin-left: 24px; width: 200px; height: 15px;\"><button id=\"create-follow\" style=\"cursor: pointer; border-radius: 10px; width: 100%; border: none; background-color: rgb(220, 220, 220);\" type=\"button\"><b>팔로우</b></button></div>");
								}
								
							}
						</script>
					</div>
				</div>
				<div style="position: relative; float: left; padding-top: 20px; width: 300px; height: auto; border-bottom: 2px solid black;">
					<p style="position: relative; float: left; top: -10px; margin: 0;"><b>{{userEntity.name}}</b></p><br>
					{{#infoEntity}}
					<div style="position: relative; float: left; width: 240px;">
						<p style="position: relative; float: left; top: -10px; margin: 0;">{{intro_comment}}</p>
					</div>
					<input type="hidden" value="{{userEntity.user_id}}" id="logout-user-id">
					<input type="hidden" value="{{loginEntity.user_id}}" id="login-user-id">
					<script>
						var a = document.querySelector("#logout-user-id");
						var b = document.querySelector("#login-user-id");
						if(a.value == b.value) {
							document.write("<div style=\"position: relative; float: right; top: -10px; width: 60px; border-radius: 5px; background-color: rgb(220, 220, 220);\"><a style=\"text-decoration-line: none; margin: 0px 3px; font-size: 10pt; color: black;\" href=\"/logout\"><b>로그아웃</b></a></div>");
						}
					</script>
					{{/infoEntity}}
				</div>
				<script>
					var i=0;
					var j=0;
				</script>
				<div style="position: relative; float: left; margin-top: 20px; border-bottom: 30px; text-align: center;">
					{{#feedEntity}}
					<div id="feed-{{feed_id}}">
						<div OnClick="location.href ='/profile/{{user.user_id}}'" style="cursor: pointer; text-align: left;">
							<div style="position: relative; float: left; width: 30px; height: 30px; border-radius: 15px; border: 1px solid black;">
								<input type="hidden" value="{{user.profile_photo}}" id="getprofile_photo1">
								<script>
									var a = document.querySelectorAll("#getprofile_photo1");
									var x = [];
									x.push(a[i].value);
									if(a[i].value == 0) {
										console.log("사진없음");
										document.write("<img src=\"https://www.snsboom.co.kr/common/img/default_profile.png\" style=\"border-radius: 15px; width: 100%; height: 100%;\">");
									}
									else {
										document.write("<img src=\"{{user.profile_photo}}\" style=\"border-radius: 15px; width: 100%; height: 100%;\">");
									}
									i++;
								</script>
							</div>
							<div style="position: relative; float: left; width: 60px; height: 30px; line-height : 30px; margin-left: 10px;">
								{{user.user_id}}
							</div>
							<input type="hidden" value="{{loginEntity.user_id}}" id="getuserEntity">
							<input type="hidden" value="{{user.user_id}}" id="getfeeduser">
							<input type="hidden" value="{{feed_id}}" id="getfeedid">
							<script>
								var b = document.querySelectorAll("#getuserEntity");
								var c = document.querySelectorAll("#getfeeduser");
								var d = document.querySelectorAll("#getfeedid");
								if(b[j].value == c[j].value) {
									document.write("<div style=\"position: relative; float: right; margin-top: 5px;\"><button id=\"delete-feed\" style=\"cursor: pointer; border: none; background: rgb(220, 220, 220); border-radius: 8px; padding: 3px 5px;\" type=\"button\" data-comment-id="+d[j].value+">삭제</button></div>")
								}
								j++;
							</script>
						</div>
						<div style="margin-top: 10px; width: 300px; height: 300px; position: relative; float: left; border: 1px solid black;">
							<img src="{{feed_photo}}" alt="{{feed_photo}}" style="width: 100%; height: 100%;">
						</div>
						<div style="width: 300px; height: auto; position: relative; float: left; text-align: left; margin-bottom: 20px; margin-top: 10px;">
							<p OnClick="location.href ='/feed/likes/{{feed_id}}'" style="display: inline-block; cursor: pointer; font-size: 0.85em; margin: 0px;">좋아요 {{likes}}개</p>
							<p style="font-size: 0.85em; margin: 0px;"><b>{{feed_comment}}</b></p>
							<div OnClick="location.href ='/feed/comments/{{feed_id}}'" style="cursor: pointer; position: relative; float: left; width: 302px;">
								<p style="font-size: 0.75em; margin: 0px;">댓글 보기</p>
							</div>
						</div>
					</div>
					{{/feedEntity}}
				</div>
			</fieldset>
		</article>
	</section>	
	<script>
		{
			const deletefeed = document.querySelectorAll("#delete-feed");
	
			console.log(deletefeed.length);
	
			deletefeed.forEach(btn => {
				btn.addEventListener("click", function(event) {
					const deletefeedBtn = event.srcElement;
					const deleteid = deletefeedBtn.getAttribute("data-comment-id");
					console.log(`삭제 버튼 클릭: ${deleteid}번 댓글`);
					// 삭제 API 호출 및 처리
					const url = `/api/feed/delete/${deleteid}`; // 백틱 숫자 물결 키
					fetch(url, {
						method: "DELETE"
					}).then(response => {
						// 댓글 삭제 실패 처리
						if (!response.ok) {
							alert("댓글 삭제 실패..!");
							return;
						}
	
						// 삭제 성공 시, 댓글을 화면에서 지움!
						const target = document.querySelector(`#feed-${deleteid}`);
						target.remove();
						
					})
				});
			});
		}
	</script>
	<script>
		{
			const deletefollow = document.querySelector("#delete-follow");
	
			deletefollow.addEventListener("click", function() {
				var a = document.querySelector("#logout-user-id");
				var b = document.querySelector("#login-user-id");
				const comment = {
					follow_id: document.querySelector("#logout-user-id").value,
					user_id: document.querySelector("#login-user-id").value
				};

				console.log(comment);
							
				// 삭제 API 호출 및 처리
				const url = `/api/follow/delete/${comment.follow_id}/${comment.user_id}`;
				fetch(url, {
					method: "DELETE",
					body: JSON.stringify(comment),
					headers: {
						"Content-Type": "application/json"
					}
				}).then(response => {
					// 댓글 삭제 실패 처리
					if (!response.ok) {
						alert("댓글 삭제 실패..!");
						return;
					}
					window.location.reload();
				})
			});
		}
	</script>
	<script>
		{
			const createfollow = document.querySelector("#create-follow");
	
			createfollow.addEventListener("click", function() {
				var a = document.querySelector("#logout-user-id");
				var b = document.querySelector("#login-user-id");
				const comment = {
					follow_id: document.querySelector("#logout-user-id").value,
					user_id: document.querySelector("#login-user-id").value
				};
							
				// fetch() - Talend API 요청을 JavaScript로 보내준다!
				const url = `/api/follow/create/${comment.follow_id}/${comment.user_id}`;
				fetch(url, {
					method: "post",
					body: JSON.stringify(comment),
					headers: {
						"Content-Type": "application/json"
					}
				}).then(response => {
					// 현재 페이지 새로고침
					window.location.reload();
				});
			});
		}
	</script>
</body>
</html>
