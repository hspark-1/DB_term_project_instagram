<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<script src="https://code.jquery.com/jquery-3.6.0.slim.js" integrity="sha256-HwWONEZrpuoh951cQD1ov2HUK5zA5DwJ1DNUXaM6FsY=" crossorigin="anonymous"></script>
	<title>Document</title>
	<style>
		.container {
			width: 300px; 
			height: 500px; 
			border-radius: 10px; 
			text-align: center; 
			position: relative; 
			left: 40vw; 
			top: 50%; 
			overflow: auto;
			margin-top: 100px;
		}
		.container::-webkit-scrollbar {
		  width: 0px;
		}
		.h1-size {
			font-size: 2em !important;
			margin: 0px;
		}
		.direct-sender {
			position: relative; 
			right: 0px; 
			width: auto; 
			margin-bottom: 15px; 
			text-align: center;
		}
		.direct-user {
			position: relative; 
			left: 58px; 
			width: 80%; 
			margin-bottom: 15px; 
			text-align: center;
		}
		.text-user {
			width: auto;
			min-width: 15px;
			text-align: center;
			padding: 5px 10px;
			display: inline-block;
			border-radius: 20px;
			border: 1px solid black;
			background-color: rgb(239, 239, 239);
		}
		.text-sender {
			width: auto;
			min-width: 15px;
			text-align: center;
			padding: 5px 10px;
			display: inline-block;
			border-radius: 20px;
			border: 1px solid black;
		}
	</style>
</head>
<body>
	<section>
		<article>
			<fieldset class="container" id="mydiv">
				<legend style="text-align: left;"><h1 class="h1-size"><b style="text-transform:uppercase;">
					<div OnClick="location.href ='/direct/inbox'" style="cursor: pointer;">
					<img src="https://cdn-icons-png.flaticon.com/512/130/130882.png" style="width: 22px">
					{{#senderId}}{{user_id}}{{/senderId}}</b></h1>
				</div>
				</legend>
				
					<input type="hidden" value="{{user.user_id}}" id="user_id">
					<input type="hidden" value="{{senderId.profile_photo}}" id="profile_photo">
					{{#DMdetail}}
					<input type="hidden" value="{{sender_id}}" id="sender_id">
					<input type="hidden" value="{{comment}}" id="comment">
					<input type="hidden" value="{{time}}" id="time">
					{{/DMdetail}}
					<script>


						var user_id = document.querySelector("#user_id");
						var a = document.querySelectorAll("#sender_id");
						var b = document.querySelectorAll("#comment");
						var c = document.querySelectorAll("#time");
						var d = document.querySelectorAll("#profile_photo");
						var x = [];
						var y = [];
						var z = [];
						for(var i = 0; i <= a.length-1; i++){
							x.push(a[i].value);
							y.push(b[i].value);
							z.push(c[i].value);
							if(x[i] == user_id.value) {
								document.write("<div class=\"direct-user\"><div style=\"width: 100%; margin: 0;\"><div style=\"text-align: right;\"><div class=\"text-user\"><p style=\"margin: 0;\">"+y[i]+"</p></div></div></div></div>");
							}
							else {
								if(d[0].value == 0) {
									document.write("<div class=\"direct-sender\"><div style=\"width: 80%;\"><div style=\"text-align: left;\"><div style=\"position: relative; float: left; width: 32px; height: 32px; margin-right: 5px; border-radius: 16px; border: 1px solid black;\">"
									+"<img OnClick=\"location.href ='/profile/" + x[i] + "'\" style=\"cursor: pointer; border-radius: 25px; width: 100%; height: 100%;\" src=\"https://www.snsboom.co.kr/common/img/default_profile.png\"></div><div class=\"text-sender\"><p style=\"margin: 0;\">"+y[i]+"</p></div></div></div></div>");
								}
								else {
									document.write("<div class=\"direct-sender\"><div style=\"width: 80%;\"><div style=\"text-align: left;\"><div style=\"position: relative; float: left; width: 32px; height: 32px; margin-right: 5px; border-radius: 16px; border: 1px solid black;\">"
									+"<img OnClick=\"location.href ='/profile/" + x[i] + "'\" style=\"cursor: pointer; border-radius: 25px; width: 100%; height: 100%;\" src=\"" + d[0].value + "\"></div><div class=\"text-sender\"><p style=\"margin: 0;\">"+y[i]+"</p></div></div></div></div>");
								}
							}
						}
				
					</script>
			</fieldset>
			<form>
				<div style="position: relative; float: left; border-bottom-right-radius: 10px; border-bottom-left-radius: 10px; left: 40vw; top: -20px; width: 300px; height: 10px; margin: 2px; border: 2px; padding: 12px; border-width: 2px; border-image: initial;
				border-style: groove; border-color: rgb(192, 192, 192); background-color: white;">
					<input type="text" id="getcomment" placeholder="메시지 보내기..." style="border: none; outline: none; border-style: none; border-color: Transparent; position: relative; float: left; top: -10px; left: -6px; height: 26px; width: 78%;">
					<input type="hidden" value="{{user.user_id}}" id="getsender_id">
					<input type="hidden" value="{{senderId.user_id}}" id="getreceiver_id">
					<div style="position: relative; float: left; top: -7px; left: 12px; margin-left: 0px;">
						<button id="dm-create-btn" style="border: none; background: none;" type="button"><b>보내기</b></button>
					</div>
				</div>
			</form>
			<script>
				{
					// 수정 완료 버튼
					const commentUpdateBtn = document.querySelector("#dm-create-btn");
		
					// 클릭 이벤트 감지 및 처리
					commentUpdateBtn.addEventListener("click", function() {
						const date = new Date();
						const year = date.getFullYear();
						const month = ('0' + (date.getMonth() + 1)).slice(-2);
						const day = ('0' + date.getDate()).slice(-2);
						const dateStr = year + '-' + month + '-' + day;
						const hours = ('0' + date.getHours()).slice(-2);
						const minutes = ('0' + date.getMinutes()).slice(-2);
						const seconds = ('0' + date.getSeconds()).slice(-2);
						const timeStr = hours + ':' + minutes + ':' + seconds;
		
						// 수정 댓글 객체 생성
						const comment = {
							sender_id: document.querySelector("#getsender_id").value,
							receiver_id: document.querySelector("#getreceiver_id").value,
							Comment: document.querySelector("#getcomment").value,
							time: dateStr + "T" + timeStr
						};
						console.log(comment);
		
						// fetch() - Talend API 요청을 JavaScript로 보내준다!
						const url = "/api/create/DM";
						fetch(url, {
							method: "post",
							body: JSON.stringify(comment),
							headers: {
								"Content-Type": "application/json"
							}
						}).then(response => {
							// 현재 페이지 새로고침
							window.location.reload();
						});
					});
		
				}
			</script>
		</article>
	</section>	
	<script>
		var objDiv = document.getElementById("mydiv");
		objDiv.scrollTop = objDiv.scrollHeight;
		$('#mydiv').scrollTop($('#mydiv')[0].scrollHeight);
	</script>
</body>
</html>
