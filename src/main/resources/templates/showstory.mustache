<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
	<style>
		.container {
			width: 300px; 
			max-width: 300px;
			height: 530px; 
			border-radius: 10px; 
			text-align: center; 
			position: relative; 
			left: 40vw; 
			top: 50%; 
			overflow: auto;
			margin-top: 100px;
			padding-bottom: 0;
		}
		.container::-webkit-scrollbar {
		  width: 0px;
		}
		.h1-size {
			font-size: 2em !important;
			margin: 0px;
		}
		.container-story {
			width: 302px;
			height: 400px;
			transition: transform 0.8s;
		}
		.inner-story {
			position: relative;
			width: 302px;
			height: 400px;
			float: left;
		}
		.btn-prev {
			width: 150px;
			height: 300px;
			position: absolute;
			left: 0px;
			top: 43px;
			background-color: transparent;
			border: none;
		}
		.btn-next {
			width: 150px;
			height: 300px;
			position: absolute;
			right: 0px;
			top: 43px;
			background-color: transparent;
			border: none;
		}
	</style>
</head>
<body>
	<section>
		<article>
			<fieldset class="container">
				<legend style="text-align: left;"><h1 class="h1-size"><b style="text-transform:uppercase;">
					<div OnClick="location.href ='javascript:history.back()'" style="cursor: pointer;">
					<img src="https://cdn-icons-png.flaticon.com/512/130/130882.png" style="width: 22px">
					Story</b></h1>
				</div>
				</legend>
				<div style="position: relative; float: left; margin-top: 10px; border-bottom: 30px; text-align: center;">
					<script>
						var i=0;
						var j=0;
					</script>
					<div style="overflow: hidden; width: 302px;">
						<input type="hidden" value="{{countstory}}" id="count-story">
						<div class="container-story">
							<script>
								var a = document.querySelector("#count-story");
								a = a.value * 302;
								a = a + 'px';
								console.log(a);
								document.querySelector(".container-story").style.width = a;
							</script>
							{{#stories}}
							<div id="story-{{story_id}}" class="inner-story">
								<div style="text-align: left;">
									<div OnClick="location.href ='/profile/{{user.user_id}}'" style="cursor: pointer; position: relative; float: left; width: 30px; height: 30px; border-radius: 15px; border: 1px solid black;">
										<input type="hidden" value="{{user.profile_photo}}" id="getprofile_photo1">
										<script>
											var a = document.querySelectorAll("#getprofile_photo1");
											var x = [];
											x.push(a[i].value);
											if(a[i].value == 0) {
												console.log("사진없음");
												document.write("<img src=\"https://www.snsboom.co.kr/common/img/default_profile.png\" style=\"border-radius: 15px; width: 100%; height: 100%;\">");
											}
											else {
												document.write("<img src=\"{{user.profile_photo}}\" style=\"border-radius: 15px; width: 100%; height: 100%;\">");
											}
											i++;
										</script>
									</div>
									<div OnClick="location.href ='/profile/{{user.user_id}}'" style="cursor: pointer; position: relative; float: left; width: 60px; height: 30px; line-height : 30px; margin-left: 10px;">
										{{user.user_id}}
									</div>
									<input type="hidden" value="{{userEntity.user_id}}" id="getuserEntity">
									<input type="hidden" value="{{user.user_id}}" id="getstoryuser">
									<input type="hidden" value="{{story_id}}" id="getstoryid">
									<script>
										var b = document.querySelectorAll("#getuserEntity");
										console.log(b);
										var c = document.querySelectorAll("#getstoryuser");
										console.log(c);
										var d = document.querySelectorAll("#getstoryid");
										console.log(d);
										if(b[j].value == c[j].value) {
											document.write("<div style=\"position: relative; float: right; margin-top: 5px;\"><button id=\"delete-story\" style=\"cursor: pointer; border: none; background: rgb(220, 220, 220); border-radius: 8px; padding: 3px 5px;\" type=\"button\" data-comment-id="+d[j].value+">삭제</button></div>")
										}
										j++;
									</script>
								</div>
								<div style="margin-top: 10px; width: 300px; height: 300px; position: relative; float: left; border: 1px solid black;">
									<img src="{{story_photo}}" alt="{{story_photo}}" style="width: 100%; height: 100%;">
								</div>
								<button class="btn-prev"></button>
								<button class="btn-next"></button>
								<div style="width: 300px; height: auto; position: relative; float: left; text-align: left; margin-bottom: 20px; margin-top: 10px;">
									<div OnClick="location.href ='/story/check/{{story_id}}'" style="cursor: pointer; position: relative; float: left; width: 302px;">
										<p style="font-size: 0.75em; margin: 0px;">조회 보기</p>
									</div>
								</div>
							</div>
							{{/stories}}
							<script>
								var a = document.querySelector("#count-story");
								var k = 0;
								document.querySelectorAll('.btn-prev').forEach(btn => {
									btn.addEventListener("click", function() {
										if(k < a.value && k != 0) {
											var transprev = (k-1) * 302;
											document.querySelector(".container-story").style.transform = 'translate(-'+transprev+'px)';
											k--;
										}
									});
								});
								k=0;
								document.querySelectorAll('.btn-next').forEach(btn => {
									btn.addEventListener("click", function() {
										if(k+1 < a.value) {
											var transnext = (k+1) * 302;
											document.querySelector(".container-story").style.transform = 'translate(-'+transnext+'px)';
											k++;
										}
									});
								});
							</script>
						</div>
					</div>
				</div>
			</fieldset>
		</article>
	</section>
</body>
<script>
	{
		const deletestory = document.querySelectorAll("#delete-story");

		console.log(deletestory.length);

		deletestory.forEach(btn => {
			btn.addEventListener("click", function(event) {
				const deletestoryBtn = event.srcElement;
				const deleteid = deletestoryBtn.getAttribute("data-comment-id");
				console.log(`삭제 버튼 클릭: ${deleteid}번 댓글`);
				// 삭제 API 호출 및 처리
				const url = `/api/story/delete/${deleteid}`; // 백틱 숫자 물결 키
				fetch(url, {
					method: "DELETE"
				}).then(response => {
					// 댓글 삭제 실패 처리
					if (!response.ok) {
						alert("댓글 삭제 실패..!");
						return;
					}

					// 삭제 성공 시, 댓글을 화면에서 지움!
					const target = document.querySelector(`#story-${deleteid}`);
					target.remove();
					window.location.reload();
				})
			});
		});
	}
</script>
</html>